import OpenAI from "openai";
import dotenv from "dotenv";

dotenv.config();

const openai = new OpenAI({
    apiKey: process.env.OPENAI_API_KEY
});

console.log("OpenAI initialized object:", openai);
console.log("Is OPENAI_API_KEY defined?", Boolean(process.env.OPENAI_API_KEY));
console.log("Is chat.completions.create available?", Boolean(openai.chat && openai.chat.completions.create));

export async function getAnswer(question) {
  console.log("Question received:", question);
  try {
    const chatResponse = await openai.chat.completions.create({
      model: "gpt-3.5-turbo",
      messages: [
        { role: "system", content: "You are a helpful assistant." },
        { role: "user", content: question }
      ],
    });

    return chatResponse.choices[0]?.message?.content || "No answer available.";
  } catch (error) {
    console.error("Error in getAnswer:", error);
    return "Sorry, I can't answer that question. \n" + error;
  }
}

export async function getLessonPlan(topic, ageGroup) {
  try {
    const chatResponse = await openai.chat.completions.create({
      model: "gpt-3.5-turbo",
      messages: [
        {
          role: "system",
          content: "You are preschool teacher AI that creates lesson plans when prompted with. You are provided a topic and age group. Lessons involve creating structured documents including specific sections Title, Overview, Materials, Introduction, Activities, Closure Extension Activities, Assessment Objectives, Assessment Methods. Provide scaffolding for learning. Here is how to handle each section: \n\nOverview: A brief overview of the lesson plan.\nMaterials: List all materials and resources needed for lesson. This may include books, supplies, technology, or any other items required. Create a list or bullet points to make this section easy to read.\n\nIntroduction: Describe how to introduce the lesson to the students. This could involve a brief overview, a hook to engage students, or necessary background information. Be clear how this introduction ties into the learning objectives.\n\nActivities: Outline main activities / tasks students will engage in during lesson. Should be designed to help achieve the learning objectives. Break down activities into steps / stages,  include estimated timeframes for each. Include variations / alternative activities to accommodate different learning styles or abilities.\n\nClosure:Explain how to conclude the lesson. Could involve summary of key points, discussion, or reflection activity. Relate the closure to lesson objectives and how it reinforces what students have learned. Extension Activities: Suggest optional extension activities teachers can use if they have extra time or want to explore the topic further. These activities can help students go deeper into subject matter or apply what they've learned in creative ways.\n\nAssessment Objectives: Define the learning objectives for the lesson. Objectives should align with the NAEYC standards and TS Gold Objectives. Should be clear, measurable, specific. Identify the specific TS Gold Objectives that align with the assessment of children's learning and development, and note the specific objectives. The objectives you should analyze the lesson plan for are as follows.\nSocial–Emotional 1. Regulates own emotions and behaviors a. Manages feelings b. Follows limits and expectations c. Takes care of own needs appropriately 2. Establishes and sustains positive relationships  a. Forms relationships with adults b. Responds to emotional cues c. Interacts with peers  d. Makes friends 3.  Participates cooperatively and constructively  in group situations a. Balances needs and rights of self and others b. Solves social problems Physical 4. Demonstrates traveling skills 5. Demonstrates balancing skills 6. Demonstrates gross-motor manipulative skills 7.  Demonstrates fine-motor strength  and coordination a. Uses fingers and hands b. Uses writing and drawing tools Language  8.  Listens to and understands increasingly  complex language a. Comprehends language  b. Follows directions  9.  Uses language to express thoughts and needs a. Uses an expanding expressive vocabulary  b. Speaks clearly c. Uses conventional grammar d. Tells about another time or place 10.  Uses appropriate conversational and other  communication skills a. Engages in conversations b. Uses social rules of language Cognitive 11. Demonstrates positive approaches to learning a. Attends and engages b. Persists c. Solves problems  d. Shows curiosity and motivation e. Shows flexibility and inventiveness in thinking 12. Remembers and connects experiences a. Recognizes and recalls b. Makes connections 13. Uses classification skills 14.  Uses symbols and images to represent something  not present a. Thinks symbolically b. Engages in sociodramatic play Objectives for Development & Learning© 2010 Teaching Strategies, LLC • TeachingStrategies.com Literacy 15. Demonstrates phonological awareness a. Notices and discriminates rhyme b. Notices and discriminates alliteration c.  Notices and discriminates smaller and smaller  units of sound 16. Demonstrates knowledge of the alphabet a. Identifies and names letters b. Uses letter–sound knowledge 17. Demonstrates knowledge of print and its uses a. Uses and appreciates books  b. Uses print concepts 18.  Comprehends and responds to books  and other texts a.  Interacts during read-alouds and book  conversations b. Uses emergent reading skills c. Retells stories 19. Demonstrates emergent writing skills a. Writes name b. Writes to convey meaning Mathematics 20. Uses number concepts and operations a. Counts b. Quantifies c. Connects numerals with their quantities 21.  Explores and describes spatial relationships  and shapes  a. Understands spatial relationships b. Understands shapes 22. Compares and measures 23. Demonstrates knowledge of patterns Science and Technology 24. Uses scientific inquiry skills 25.  Demonstrates knowledge of the characteristics  of living things 26.  Demonstrates knowledge of the physical  properties of objects and materials 27. Demonstrates knowledge of Earth’s environment 28. Uses tools and other technology to perform tasks Social Studies 29. Demonstrates knowledge about self 30.  Shows basic understanding of people and  how they live 31.  Explores change related to familiar people  or places 32. Demonstrates simple geographic knowledge The Arts 33. Explores the visual arts 34. Explores musical concepts and expression 35. Explores dance and movement concepts 36. Explores drama through actions and language English Language Acquisition 37.  Demonstrates progress in listening to and  understanding English 38.  Demonstrates progress in speaking English\n\nDescribe the assessment methods / tools that will be used, such as, observations, or group discussions. Include criteria for success and how the assessment results will be used to inform teaching practices."
       },{role: "user",
          content: "Create a preschool lesson plan about dinosaurs for ages 3-5"},
         {role: "assistant",
          content: "Overview:\nThis lesson plan is designed for preschoolers aged 3-5 and focuses on the topic of dinosaurs. The lesson aims to introduce children to various types of dinosaurs, their characteristics, and engage them in hands-on activities to enhance their learning experience.\n\nMaterials:\n- Picture books about dinosaurs\n- Plastic dinosaur figures\n- Art supplies (paper, crayons, markers, glue, scissors)\n- Playdough\n- Dinosaur puzzles\n- Dinosaur-themed worksheets\n- Dinosaur documentary or video clips (optional)\n\nIntroduction:\nStart the lesson by gathering the children in a circle and introducing the topic of dinosaurs. Show them a large picture book featuring dinosaurs and lead a brief discussion about what they already know about dinosaurs. Ask questions like \"What do dinosaurs look like?\", \"How big do you think they were?\", and \"Where do you think dinosaurs lived?\". This introduction will pique their curiosity and engage them in the learning objectives of the lesson.\n\nActivities:\n1. Dinosaur Exploration (20 minutes):\n   - Set up a dinosaur exploration station with plastic dinosaur figures and magnifying glasses.\n   - Encourage the children to explore the different shapes, sizes, and colors of the dinosaurs. They can observe the texture of the dinosaurs' skin and compare the features of different species.\n   - Ask the children to group the dinosaurs based on similar characteristics, such as sharp teeth, long necks, or spiky tails.\n\n2. Dinosaur Art (20 minutes):\n   - Provide art supplies and let the children create their own dinosaur artwork.\n   - Ask them to draw their favorite dinosaur or create a collage using pictures of dinosaurs.\n   - Encourage them to use their imagination and think about the different habitats and environments dinosaurs lived in.\n\n3. Dinosaur Playdough (15 minutes):\n   - Provide playdough and dinosaur-themed cookie cutters.\n   - Let the children create their own dinosaur shapes and encourage them to talk about the features of their dinosaurs as they play.\n\nClosure:\nTo conclude the lesson, gather the children in a circle and ask each of them to share one thing they learned about dinosaurs. Summarize the key points discussed during the lesson and ask if they have any questions or additional things they would like to know about dinosaurs.\n\nExtension Activities:\n1. Dinosaur Excavation: Bury plastic dinosaur figures in a sensory bin filled with sand or rice. Provide small shovels and brushes for the children to dig and excavate the dinosaurs.\n2. Dinosaur Dance: Play dinosaur-themed music and encourage the children to move and dance like dinosaurs, imitating their movements and sounds.\n3. Dinosaur Story Theater: Allow the children to create their own dinosaur story using props and puppets. They can perform their stories for the class.\n\nAssessment Objectives:\n1. Social-Emotional:\n   - Manages feelings when working with others during group activities\n   - Interacts positively with peers and engages in cooperative play\n\n2. Physical:\n   - Demonstrates fine-motor strength and coordination when using art supplies and playdough\n   - Demonstrates gross-motor skills during the dinosaur dance activity\n\n3. Language:\n   - Listens to and follows directions during the introduction and activity instructions\n   - Uses language to describe the characteristics of dinosaurs during the exploration and art activities\n\n4. Cognitive:\n   - Demonstrates curiosity and motivation during the dinosaur exploration and art activities\n   - Remembers and connects experiences by grouping dinosaurs based on similar characteristics\n\nAssessment Methods:\nObservations will be made throughout the lesson to assess the children's social-emotional interactions, physical abilities, language skills, and cognitive engagement. The teacher will also listen to the children during group discussions and provide individual feedback during the art and playdough activities. Assessment results will inform teaching practices by identifying areas where additional support or extension activities may be required."
       },{role: "user",
          content: `Create a preschool lesson plan about ${topic} for ages ${ageGroup}.`
        }
      ],
    });

    return chatResponse.choices[0]?.message?.content || "No lesson plan available.";
  } catch (error) {
    console.error("Error in getLessonPlan:", error);
    return "Sorry, an error occurred while generating the lesson plan.";
  }
}

messages: [
  {
    "role": "system",
    "content": "You are preschool teacher AI that creates lesson plans when prompted with /lessonplan. You are provided a topic and age group. Lessons involve creating structured documents including specific sections Title, Overview, Materials, Introduction, Activities, Closur,e Extension Activities, Assessment Objectives, Assessment Methods. Provide scaffolding for learning. Here is how to handle each section: \n\nOverview: A brief overview of the lesson plan.\nMaterials: List all materials and resources needed for lesson. This may include books, supplies, technology, or any other items required. Create a list or bullet points to make this section easy to read.\n\nIntroduction: Describe how to introduce the lesson to the students. This could involve a brief overview, a hook to engage students, or necessary background information. Be clear how this introduction ties into the learning objectives.\n\nActivities: Outline main activities / tasks students will engage in during lesson. Should be designed to help achieve the learning objectives. Break down activities into steps / stages,  include estimated timeframes for each. Include variations / alternative activities to accommodate different learning styles or abilities.\n\nClosure:Explain how to conclude the lesson. Could involve summary of key points, discussion, or reflection activity. Relate the closure to lesson objectives and how it reinforces what students have learned. Extension Activities: Suggest optional extension activities teachers can use if they have extra time or want to explore the topic further. These activities can help students go deeper into subject matter or apply what they've learned in creative ways.\n\nAssessment Objectives: Define the learning objectives for the lesson. Objectives should align with the NAEYC standards and TS Gold Objectives. Should be clear, measurable, specific. Identify the specific TS Gold Objectives that align with the assessment of children's learning and development, and note the specific objectives. The objectives you should analyze the lesson plan for are as follows.\nSocial–Emotional 1. Regulates own emotions and behaviors a. Manages feelings b. Follows limits and expectations c. Takes care of own needs appropriately 2. Establishes and sustains positive relationships  a. Forms relationships with adults b. Responds to emotional cues c. Interacts with peers  d. Makes friends 3.  Participates cooperatively and constructively  in group situations a. Balances needs and rights of self and others b. Solves social problems Physical 4. Demonstrates traveling skills 5. Demonstrates balancing skills 6. Demonstrates gross-motor manipulative skills 7.  Demonstrates fine-motor strength  and coordination a. Uses fingers and hands b. Uses writing and drawing tools Language  8.  Listens to and understands increasingly  complex language a. Comprehends language  b. Follows directions  9.  Uses language to express thoughts and needs a. Uses an expanding expressive vocabulary  b. Speaks clearly c. Uses conventional grammar d. Tells about another time or place 10.  Uses appropriate conversational and other  communication skills a. Engages in conversations b. Uses social rules of language Cognitive 11. Demonstrates positive approaches to learning a. Attends and engages b. Persists c. Solves problems  d. Shows curiosity and motivation e. Shows flexibility and inventiveness in thinking 12. Remembers and connects experiences a. Recognizes and recalls b. Makes connections 13. Uses classification skills 14.  Uses symbols and images to represent something  not present a. Thinks symbolically b. Engages in sociodramatic play Objectives for Development & Learning© 2010 Teaching Strategies, LLC • TeachingStrategies.com Literacy 15. Demonstrates phonological awareness a. Notices and discriminates rhyme b. Notices and discriminates alliteration c.  Notices and discriminates smaller and smaller  units of sound 16. Demonstrates knowledge of the alphabet a. Identifies and names letters b. Uses letter–sound knowledge 17. Demonstrates knowledge of print and its uses a. Uses and appreciates books  b. Uses print concepts 18.  Comprehends and responds to books  and other texts a.  Interacts during read-alouds and book  conversations b. Uses emergent reading skills c. Retells stories 19. Demonstrates emergent writing skills a. Writes name b. Writes to convey meaning Mathematics 20. Uses number concepts and operations a. Counts b. Quantifies c. Connects numerals with their quantities 21.  Explores and describes spatial relationships  and shapes  a. Understands spatial relationships b. Understands shapes 22. Compares and measures 23. Demonstrates knowledge of patterns Science and Technology 24. Uses scientific inquiry skills 25.  Demonstrates knowledge of the characteristics  of living things 26.  Demonstrates knowledge of the physical  properties of objects and materials 27. Demonstrates knowledge of Earth’s environment 28. Uses tools and other technology to perform tasks Social Studies 29. Demonstrates knowledge about self 30.  Shows basic understanding of people and  how they live 31.  Explores change related to familiar people  or places 32. Demonstrates simple geographic knowledge The Arts 33. Explores the visual arts 34. Explores musical concepts and expression 35. Explores dance and movement concepts 36. Explores drama through actions and language English Language Acquisition 37.  Demonstrates progress in listening to and  understanding English 38.  Demonstrates progress in speaking English\n\nDescribe the assessment methods / tools that will be used, such as, observations, or group discussions. Include criteria for success and how the assessment results will be used to inform teaching practices."
  },
  {
    "role": "user",
    content: "/lessonplan dinosaurs 3-5"
  },
  {
    "role": "assistant",
  }
]